<!doctype html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Dino Kernel - Emulação v86</title>
<style>
  :root {
    --bg: #000000;
    --fg: #00ff66;
    --muted: #00aa44;
    --accent: #00dd55;
  }
  html, body {
    margin: 0;
    padding: 0;
    background: var(--bg);
    color: var(--fg);
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  }
  .wrap {
    display: flex;
    min-height: 100vh;
    align-items: center;
    justify-content: center;
    padding: 24px;
    box-sizing: border-box;
  }
  .card {
    width: min(980px, 100%);
    border: 1px solid var(--muted);
    background: #000;
    box-shadow: 0 0 0 1px #003a1f inset, 0 6px 40px rgba(0,255,102,0.08);
  }
  .header {
    padding: 16px 18px;
    border-bottom: 1px solid #003a1f;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 16px;
  }
  .title {
    font-size: 16px;
    letter-spacing: 0.06em;
    color: var(--accent);
    text-transform: uppercase;
  }
  .btn {
    appearance: none;
    background: transparent;
    color: var(--accent);
    border: 1px solid var(--accent);
    padding: 8px 14px;
    cursor: pointer;
    font: inherit;
    transition: background 0.15s ease, color 0.15s ease;
  }
  .btn:hover { background: var(--accent); color: #001b0e; }
  .btn:disabled { opacity: 0.5; cursor: not-allowed; }
  .body {
    display: grid;
    grid-template-columns: 1fr;
  }
  .ascii {
    padding: 18px;
    color: var(--fg);
    white-space: pre;
    overflow: auto;
  }
  .hint {
    color: var(--muted);
    padding: 0 18px 12px 18px;
  }
  .screen {
    display: grid;
    place-items: center;
    background: #001b0e;
    border-top: 1px solid #003a1f;
    aspect-ratio: 4/3;
    width: 100%;
  }
  #screen_container {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .footer {
    padding: 10px 18px 16px 18px;
    border-top: 1px solid #003a1f;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 16px;
    color: var(--muted);
  }
  .progress {
    height: 6px;
    width: 180px;
    border: 1px solid #003a1f;
    background: #00160b;
    position: relative;
  }
  .bar {
    position: absolute;
    inset: 0 100% 0 0;
    background: linear-gradient(90deg, #00aa44, #00ff66);
    transition: inset-inline-end 0.1s linear;
  }
</style>
<div class="wrap">
  <div class="card">
    <div class="header">
      <div class="title">Dino Kernel — Emulação no Navegador (v86)</div>
      <div style="display:flex; gap:8px; align-items:center;">
        <button id="btn_start" class="btn" onclick="start_emulator()">Iniciar</button>
        <button id="btn_reset" class="btn" onclick="reset_emulator()" disabled>Resetar</button>
      </div>
    </div>
    <div class="body">
      <pre class="ascii" id="ascii">
        .                 .           
     dP       Dino Run     9b        
     dX     jogue agora!     Xb      
    __                         __    
  dXXXXbo.                 .odXXXXb d
 XXXXXXXXOo.           .oOXXXXXXXXVXX
 XX'~   ~'OOO8b   d8OOO'~   ~'XXXXXXX
 9XX'          '98v8P'          'XXP'
  9X.          .db|db.          .XP
    )b.  .dbo.dP''v''9b.odb.  .dX(
,dXXXXXXXXXXXb     dXXXXXXXXXXXb.
dXXXXXXXXXXXP'   .   '9XXXXXXXXXXXb
dXXXXXXXXXXXXb   d|b   dXXXXXXXXXXXXb
9XXb'   'XXXXXb.dX|Xb.dXXXXX'   'dXXP
''      9XXXXXX(   )XXXXXXP      ''
         XXXX X.'v'.X XXXX
         XP^X''b   d''X^XX 
         X. 9  ''   '  P )X
         'b  '       '  d'
          '             '
  Dino Kernel — Verde & Preto
  - Espaço: pular | ESC: sair
  - Clique em "Iniciar" para carregar a ISO e emular
      </pre>
      <div class="hint">ISO: asvarius.iso • BIOS: v86/bios/seabios.bin • VGA BIOS: v86/bios/vgabios.bin</div>
      <div class="screen">
        <div id="screen_container">
          <canvas></canvas>
          <div></div>
        </div>
      </div>
    </div>
    <div class="footer">
      <div id="status">Pronto para iniciar</div>
      <div class="progress" aria-label="Progresso de download">
        <div id="bar" class="bar"></div>
      </div>
    </div>
  </div>
</div>
<script src="v86/libv86.js"></script>
<script>
  let emulator = null;
  const statusEl = document.getElementById("status");
  const barEl = document.getElementById("bar");
  const btnStart = document.getElementById("btn_start");
  const btnReset = document.getElementById("btn_reset");

  function set_status(text) {
    statusEl.textContent = text;
  }
  function set_progress(ratio) {
    const clamped = Math.max(0, Math.min(1, ratio || 0));
    barEl.style.insetInlineEnd = `${(1 - clamped) * 100}%`;
  }

  function start_emulator() {
    if (emulator) return;
    set_status("Inicializando emulador...");
    btnStart.disabled = true;

    if (!window.V86) {
      console.error("V86 não carregado");
      set_status("Falha ao carregar v86.");
      btnStart.disabled = false;
      return;
    }

    emulator = new window.V86({
      wasm_path: "v86/v86.wasm",
      memory_size: 32 * 1024 * 1024,
      vga_memory_size: 2 * 1024 * 1024,
      screen_container: document.getElementById("screen_container"),
      bios: { url: "v86/bios/seabios.bin" },
      vga_bios: { url: "v86/bios/vgabios.bin" },
      cdrom: { url: "asvarius.iso" },
      boot_order: 0x132,
      autostart: true,
    });

    emulator.add_listener("download-progress", function(evt) {
      const total = evt.total || 0;
      const loaded = evt.loaded || 0;
      if (total > 0) {
        const pct = loaded / total;
        set_progress(pct);
        set_status(`Carregando (${Math.round(pct * 100)}%)...`);
      } else {
        set_status("Baixando recursos...");
      }
    });

    emulator.add_listener("emulator-ready", function() {
      set_progress(1);
      set_status("Emulador pronto. Boot da ISO...");
      btnReset.disabled = false;
    });

    emulator.add_listener("emulator-started", function() {
      set_status("Rodando.");
    });

    emulator.add_listener("error", function(err) {
      console.error(err);
      set_status("Erro na emulação. Veja o console.");
      btnStart.disabled = false;
    });
  }

  function reset_emulator() {
    if (!emulator) return;
    set_status("Resetando...");
    try { emulator.reset(); } catch (_) {}
  }
</script> 